<!DOCTYPE html>
<html lang="et">

<head>
<meta charset="UTF-8">
<title>Temperatuuri demo</title>

<style>
    :root {
        color: white;
    }

    .element {
        width: 60px;
        height: 60px;
        padding: 20px;
        margin: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        border: 1px solid #888;
        border-radius: 20px;
    }

    .solid   { background-color: #444; }
    .liquid  { background-color: #248; }
    .gas     { background-color: #842; }
    .unknown { background-color: transparent; }

    .statelabel {
        width: 70px;
        padding: 2px;
        display: inline-block;
        text-align: center;
        border: 1px solid #888;
        border-radius: 5px;
    }

</style>
</head>

<body style="background-color: black; display: flex; align-items: center; justify-content: center;">

    <div style="text-align: center;">
        <div style="border: 1px solid #444; border-radius: 10px; padding: 5px 10px; margin: 5px 0;">
            Temperatuur: <span id="temp_C" style="display: inline-block; width: 60px; text-align: right;"></span>°C,&emsp;rõhk:&ensp;1 atm
            <input type="range" id="temp_slider" min="0" max="1" step="0.0001" style="width: 100%;" oninput="update_temp(Number(this.value))" />
        </div>

        <nobr>Aine olek:
            <span class="statelabel solid">tahke</span>
            <span class="statelabel liquid">vedel</span>
            <span class="statelabel gas">gaas</span>
            <span class="statelabel unknown">teadmata</span>
        </nobr>
        
        <div id="elements_table" style="display: flex; flex-wrap: wrap;"></div>
    </div>

</body>

<script>
    let elements = []
    async function load_elements() {
        let response = await fetch('https://raw.githubusercontent.com/Teaduskeskus-AHHAA/perioodilisustabel-data/refs/heads/main/elements-data.json');
        elements = await response.json();
    }


    function temp_K_from_scale(x) { // x vahemikus 0-1
        return (-6604603400*x**5 + 14704226140*x**4 - 8612290766*x**3 + 1517143869*x**2)/185220 + 850*x;
    }

    function temp_K_to_C(t) {   // t >= 0
        return t-273.15;
    }

    function element_state(t_K, element) {
        if      (element.melt == null && element.boil == null)  { return 'unknown'; }
        else if (element.melt == null)                          { return t_K > element.boil ? 'gas' : 'liquid'; }
        else if (element.boil == null)                          { return t_K > element.melt ? 'unknown' : 'solid'; }
        else                                                    { return t_K > element.melt ? (t_K > element.boil ? 'gas' : 'liquid') : 'solid'; }
    }

    function update_temp(x) {
        const t_k = temp_K_from_scale(x),
              t_c = t_k < 0.2 ? Math.round(100*temp_K_to_C(t_k))/100 : Math.round(temp_K_to_C(t_k));
        document.getElementById('temp_C').innerHTML = t_c < 0 ? '−'+(-t_c) : t_c > 0 ? '+'+t_c : t_c;

        for (const e of elements) {
            document.getElementById('element_'+e.symbol).className = 'element '+element_state(t_k, e);
        }
    }

    async function init() {
        await load_elements();

        let htmlstr='';
        for (const e of elements) {
            htmlstr += `<div id="element_${e.symbol}" class="element"><div>${e.atomic}<br><span style="font-size: xx-large">${e.symbol}</span></div></div>`;
        }
        document.getElementById('elements_table').innerHTML = htmlstr;

        document.getElementById('temp_slider').value = 0.3;
        update_temp(0.3);
    }

    init()
</script>

</html>
